{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/store/dispatch-store.ts"],"sourcesContent":["\nimport { create } from \"zustand\";\n\ninterface DispatchState {\n  pickup: string | null;\n  dropoff: string | null;\n  setPickup: (location: string) => void;\n  setDropoff: (location: string) => void;\n  clearPickup: () => void;\n  clearDropoff: () => void;\n}\n\nexport const useDispatchStore = create<DispatchState>((set) => ({\n  pickup: null,\n  dropoff: null,\n  setPickup: (location) => set({ pickup: location }),\n  setDropoff: (location) => set({ dropoff: location }),\n  clearPickup: () => set({ pickup: null }),\n  clearDropoff: () => set({ dropoff: null }),\n}));\n"],"names":[],"mappings":";;;;AACA;;AAWO,MAAM,mBAAmB,IAAA,qKAAM,EAAgB,CAAC,MAAQ,CAAC;QAC9D,QAAQ;QACR,SAAS;QACT,WAAW,CAAC,WAAa,IAAI;gBAAE,QAAQ;YAAS;QAChD,YAAY,CAAC,WAAa,IAAI;gBAAE,SAAS;YAAS;QAClD,aAAa,IAAM,IAAI;gBAAE,QAAQ;YAAK;QACtC,cAAc,IAAM,IAAI;gBAAE,SAAS;YAAK;IAC1C,CAAC","debugId":null}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/map/leaflet-tracking-map.tsx"],"sourcesContent":["\n'use client';\n\nimport { memo, useEffect, useMemo, useRef, useState } from 'react';\nimport {\n  MapContainer,\n  TileLayer,\n  Marker,\n  Popup,\n  useMap,\n  useMapEvents,\n} from 'react-leaflet';\nimport L, { Map as LeafletMap } from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport { useTrackingStore } from '@/store/tracking-store';\nimport type { Vehicle } from '@/lib/types';\nimport { useDispatchStore } from '@/store/dispatch-store';\nimport { useToast } from '@/hooks/use-toast';\nimport { useRouter } from 'next/navigation';\nimport { Button } from '../ui/button';\n\n// Fix for default marker icons not appearing in Next.js\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',\n  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n});\n\n\n/* ================================\n   Imperative View Controller\n================================ */\nfunction ChangeView({\n  center,\n  zoom,\n}: {\n  center: [number, number];\n  zoom: number;\n}) {\n  const map = useMap();\n\n  useEffect(() => {\n    map.setView(center, zoom, { animate: true });\n  }, [center, zoom, map]);\n\n  return null;\n}\n\n/* ================================\n   Click-to-Pin Location Selector\n================================ */\nfunction LocationSelector() {\n    const { toast } = useToast();\n    const router = useRouter();\n    const { pickup, setPickup, setDropoff } = useDispatchStore();\n    const [pinPosition, setPinPosition] = useState<L.LatLng | null>(null);\n\n    const pinIcon = useMemo(() => new L.Icon({\n        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png',\n        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n        iconSize: [25, 41],\n        iconAnchor: [12, 41],\n        popupAnchor: [1, -34],\n        shadowSize: [41, 41]\n    }), []);\n    \n    useMapEvents({\n        click(e) {\n            const newPos = e.latlng;\n            setPinPosition(newPos);\n            const address = `${newPos.lat.toFixed(5)}, ${newPos.lng.toFixed(5)}`;\n            \n            // Smartly decide whether to set pickup or dropoff\n            let fieldToSet: 'Pickup' | 'Dropoff' = 'Pickup';\n            if (pickup) {\n                fieldToSet = 'Dropoff';\n                setDropoff(address);\n            } else {\n                setPickup(address);\n            }\n\n            toast({\n                title: `${fieldToSet} location set`,\n                description: `Coordinates: ${address}`,\n                action: (\n                    <Button variant=\"link\" size=\"sm\" onClick={() => router.push('/dashboard/dispatch')} className=\"text-white\">\n                        Go to Dispatch\n                    </Button>\n                )\n            });\n        },\n    });\n\n    // Clear pin when pickup location is cleared from elsewhere\n    useEffect(() => {\n        if (!pickup) {\n            setPinPosition(null);\n        }\n    }, [pickup]);\n\n    return pinPosition ? <Marker position={pinPosition} icon={pinIcon} /> : null;\n}\n\n\n/* ================================\n   Stable Icon Factory\n================================ */\nconst useVehicleIcons = () =>\n  useMemo(() => {\n    const base = {\n      iconSize: [28, 41] as L.PointExpression,\n      iconAnchor: [14, 41] as L.PointExpression,\n      popupAnchor: [0, -41] as L.PointExpression,\n      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n      shadowSize: [41, 41] as L.PointExpression,\n    };\n\n    return {\n      ON_TRIP: new L.Icon({ ...base, iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png' }),\n      AVAILABLE: new L.Icon({ ...base, iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png' }),\n      MAINTENANCE: new L.Icon({ ...base, iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png' }),\n      ASSIGNED: new L.Icon({ ...base, iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-violet.png' }),\n      OUT_OF_SERVICE: new L.Icon({ ...base, iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png' }),\n      SELECTED: new L.Icon({ ...base, iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-black.png' }),\n    };\n  }, []);\n\n\n/* ================================\n   Main Map Component (Fast Refresh Safe)\n================================ */\nfunction LeafletTrackingMap({\n  vehicles,\n  center,\n  zoom = 13,\n}: {\n  vehicles: Vehicle[];\n  center: [number, number];\n  zoom?: number;\n}) {\n  const mapRef = useRef<LeafletMap | null>(null);\n  const { selectedVehicle, selectVehicle } = useTrackingStore();\n  const icons = useVehicleIcons();\n\n  /* üî• CRITICAL FIX: destroy map on unmount */\n  useEffect(() => {\n    return () => {\n      if (mapRef.current) {\n        mapRef.current.remove(); // ‚Üê THIS prevents re-init error forever\n        mapRef.current = null;\n      }\n    };\n  }, []);\n\n  return (\n    <MapContainer\n      center={center}\n      zoom={zoom}\n      style={{ height: '100%', width: '100%' }}\n      scrollWheelZoom\n      preferCanvas\n      whenCreated={(map) => {\n        mapRef.current = map;\n        // Position zoom control to the bottom left\n        map.zoomControl.setPosition('bottomleft');\n      }}\n      zoomControl={true}\n    >\n      {/* IMPORTANT: Change view without rerendering MapContainer */}\n      <ChangeView center={center} zoom={zoom} />\n\n      <TileLayer\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        attribution=\"&copy; OpenStreetMap contributors\"\n      />\n\n      <LocationSelector />\n\n      {vehicles.map((v) => {\n        const isSelected = selectedVehicle?.id === v.id;\n        const statusKey = v.status as keyof ReturnType<typeof useVehicleIcons>;\n        const icon = isSelected ? icons.SELECTED : (icons[statusKey] || icons.AVAILABLE);\n        \n        return (\n          <Marker\n            key={v.id}\n            position={[v.currentLocation.lat, v.currentLocation.lng]}\n            icon={icon}\n            eventHandlers={{\n              click: () => {\n                selectVehicle(v);\n              },\n            }}\n          >\n            <Popup>\n              <div>\n                <strong>{v.plateNumber}</strong>\n                <br />\n                Status: {v.status}\n              </div>\n            </Popup>\n          </Marker>\n        );\n      })}\n    </MapContainer>\n  );\n}\n\nexport default memo(LeafletTrackingMap);\n"],"names":[],"mappings":"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","debugId":null}}]
}